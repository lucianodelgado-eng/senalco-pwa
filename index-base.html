<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Base de Datos - Se√±alco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="estilo.css" />

  <!-- PDF (salida) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>

  <!-- Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

  <!-- Seguridad: si no est√° logueado -->
  <script>
    if (localStorage.getItem("logueado") !== "true") {
      window.location.href = "login.html";
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 1000px;
      margin: auto;
      background: #0b0b20;
      color: #fff;
    }

    h1 {
      text-align: center;
      margin-top: 10px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #333;
      background: #121235;
      color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #0d0d2a;
    }

    table,
    th,
    td {
      border: 1px solid #0a0a0a;
    }

    th,
    td {
      padding: 6px;
      text-align: center;
      vertical-align: middle;
    }

    td input {
      width: 100%;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #333;
      background: #14143a;
      color: #fff;
      box-sizing: border-box;
    }

    .botones {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    .botones button {
      flex: 1 1 220px;
      padding: 12px;
      font-weight: bold;
      cursor: pointer;
      border: 0;
      border-radius: 10px;
      background: #1976d2;
      color: #fff;
    }

    .botones button:hover {
      opacity: .92;
    }

    .mini-btn {
      padding: 10px 14px;
      border-radius: 10px;
      background: #444;
      color: #fff;
      border: 0;
      cursor: pointer;
      font-weight: bold;
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .65);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .modal .box {
      background: #fff;
      color: #000;
      width: min(95vw, 900px);
      border-radius: 14px;
      padding: 16px;
      max-height: 85vh;
      overflow: auto;
    }

    .modal .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      background: #fafafa;
    }

    #logo-pdf {
      display: none;
    }

    .logo-entrada {
      width: 140px;
      display: block;
      margin: 10px auto 0;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, .5);
    }

    /* ‚úÖ Banner update */
    #update-bar {
      display: none;
      position: sticky;
      top: 0;
      z-index: 99999;
      background: #0f2a14;
      border: 1px solid rgba(255, 255, 255, .15);
      padding: 12px;
      border-radius: 12px;
      margin: 10px 0 14px;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    #update-bar .msg {
      font-weight: bold;
    }

    #update-bar .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ‚úÖ Buscador r√°pido afuera */
    .buscador-wrap {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .buscador-grid {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 10px;
      align-items: center;
    }

    @media (max-width: 700px) {
      .buscador-grid {
        grid-template-columns: 1fr;
      }
    }

    #buscador-resultados .card {
      background: #fff;
    }
  </style>
</head>

<body>

  <!-- Logo para PDF -->
  <img id="logo-pdf" src="images/logo.jpg" alt="logo" />

  <!-- Logo visible -->
  <img src="images/logo_blanco.jpg" alt="Logo Se√±alco" class="logo-entrada">

  <h1>üìä Base de Datos - Se√±alco</h1>

  <!-- ‚úÖ Banner de actualizaci√≥n -->
  <div id="update-bar">
    <div class="msg">‚¨ÜÔ∏è Hay una actualizaci√≥n disponible</div>
    <div class="actions">
      <button class="mini-btn" id="btn-actualizar-app">Actualizar</button>
      <button class="mini-btn" id="btn-ignorar-update" style="background:#555;">M√°s tarde</button>
    </div>
  </div>

  <label>Entidad</label>
  <!-- ‚úÖ input + datalist (lista abanico de entidades) -->
  <input type="text" id="entidad" list="lista-entidades" placeholder="Ej: Galicia" />
  <datalist id="lista-entidades"></datalist>

  <label>Sucursal</label>
  <input type="text" id="sucursal" placeholder="Ej: 1234" />

  <label>Abonado</label>
  <input type="text" id="abonado" placeholder="Ej: 000123" />

  <label>Central</label>
  <input type="text" id="central" placeholder="Ej: Acicomp" />

  <label>Provincia</label>
  <input type="text" id="provincia" placeholder="Ej: Buenos Aires" />

  <table id="tabla-base">
    <thead>
      <tr>
        <th>Zona</th>
        <th>Evento</th>
        <th>√Årea</th>
        <th>Dispositivo</th>
        <th>Descripci√≥n</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="botones">
    <button id="btn-limpiar-base">üßπ Limpiar</button>

    <button id="btn-subir-excel">üìÇ Importar Excel</button>
    <input id="input-excel-base" type="file"
      accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      style="position:absolute; left:-9999px; width:1px; height:1px;" />

    <button id="btn-importar-json-top">üì§ Importar JSON</button>
    <input id="input-json-base-top" type="file" accept="application/json,.json"
      style="position:absolute; left:-9999px; width:1px; height:1px;" />

    <button id="btn-importar-carpeta-top">üì¶ Importar carpeta (muchos JSON)</button>
    <input id="input-json-folder-top" type="file" accept=".json,application/json" multiple webkitdirectory directory
      style="position:absolute; left:-9999px; width:1px; height:1px;" />

    <button id="btn-guardar-rapido">üíæ Guardar en Mis Bases + Backup</button>
    <button id="btn-descargar-json-top">‚¨áÔ∏è Descargar JSON</button>

    <button id="btn-previsualizar">üëÅÔ∏è Previsualizar</button>

    <button id="btn-generar-pdf-base">üìÑ Generar PDF</button>
    <button id="btn-excel-base">üìä Exportar Excel</button>

    <button id="btn-editar-zonas123">üîì Editar Zonas 1-3</button>
    <button id="btn-bloquear-zonas123" style="display:none;">üîí Bloquear Zonas 1-3</button>

    <button id="btn-mis-bases">üìÅ Mis Bases</button>
    <button onclick="cerrarSesion()">üîí Cerrar sesi√≥n</button>
  </div>

  <!-- ‚úÖ BUSCADOR R√ÅPIDO (afuera del modal) -->
  <div class="buscador-wrap">
    <h3 style="margin:0 0 8px;">üîé Buscador r√°pido de Bases (en el tel√©fono)</h3>

    <div class="buscador-grid">
      <select id="filtro-campo">
        <option value="all">Todos</option>
        <option value="entidad">Entidad</option>
        <option value="sucursal">Sucursal</option>
        <option value="abonado">Abonado</option>
        <option value="central">Central</option>
        <option value="provincia">Provincia</option>
        <option value="nombre">Nombre</option>
      </select>

      <input id="buscar-rapido" placeholder="Escrib√≠ 3 letras y te filtra al toque..." />
    </div>

    <div id="buscador-resultados" style="margin-top:12px;"></div>

    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="mini-btn" id="btn-abrir-mis-bases">Abrir Mis Bases</button>
      <button class="mini-btn" id="btn-limpiar-buscador" style="background:#555;">Limpiar b√∫squeda</button>
    </div>
  </div>

  <!-- MODAL: PREVISUALIZAR -->
  <div id="modal-prev" class="modal">
    <div class="box">
      <div class="row">
        <h2 style="margin:0;">Previsualizaci√≥n de Base</h2>
        <button class="mini-btn" id="btn-cerrar-prev">Cerrar ‚úñ</button>
      </div>
      <div id="prev-body" style="margin-top:12px;"></div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="mini-btn" id="btn-descargar-pdf-prev">‚úÖ Descargar PDF</button>
      </div>
    </div>
  </div>

  <!-- MODAL: MIS BASES -->
  <div id="modal-bases" class="modal">
    <div class="box">
      <div class="row">
        <h2 style="margin:0;">üìÅ Mis Bases (guardadas en el tel√©fono)</h2>
        <button class="mini-btn" id="btn-cerrar-bases">Cerrar ‚úñ</button>
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <input id="nombre-base" placeholder="Nombre (ej: Galicia_Suc123)"
          style="flex:1; min-width:220px; padding:10px; border-radius:10px; border:1px solid #ddd;">
        <button class="mini-btn" id="btn-guardar-como">Guardar como</button>

        <button class="mini-btn" id="btn-descargar-json">Descargar JSON</button>
        <button class="mini-btn" id="btn-importar-json">Importar JSON</button>
        <input id="input-json-base" type="file" accept="application/json,.json"
          style="position:absolute; left:-9999px; width:1px; height:1px;" />
      </div>

      <!-- ‚úÖ Buscador dentro del modal (opcional, queda) -->
      <div style="margin-top:12px;">
        <input id="filtro-bases"
          placeholder="Buscar dentro de Mis Bases..."
          style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">
      </div>

      <hr style="margin:14px 0;">
      <div id="lista-bases-json"></div>
    </div>
  </div>

  <script>
    function cerrarSesion() {
      localStorage.removeItem("logueado");
      localStorage.removeItem("perfil");
      window.location.href = "login.html";
    }
  </script>

  <!-- ‚úÖ TU JS -->
  <script src="java-base.js"></script>

</body>

</html>