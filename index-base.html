<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Base de Datos - Se√±alco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="estilo.css" />

  <!-- PDF (salida) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>

  <!-- Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

  <!-- Seguridad: si no est√° logueado -->
  <script>
    if (localStorage.getItem("logueado") !== "true") {
      window.location.href = "login.html";
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 1000px;
      margin: auto;
      background: #0b0b20;
      color: #fff;
    }

    h1 {
      text-align: center;
      margin-top: 10px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #333;
      background: #121235;
      color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #0d0d2a;
    }

    table,
    th,
    td {
      border: 1px solid #0a0a0a;
    }

    th,
    td {
      padding: 6px;
      text-align: center;
      vertical-align: middle;
    }

    td input {
      width: 100%;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #333;
      background: #14143a;
      color: #fff;
      box-sizing: border-box;
    }

    #logo-pdf {
      display: none;
    }

    .logo-entrada {
      width: 140px;
      display: block;
      margin: 10px auto 0;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, .5);
    }

    .mini-btn {
      padding: 10px 14px;
      border-radius: 10px;
      background: #444;
      color: #fff;
      border: 0;
      cursor: pointer;
      font-weight: bold;
    }

    .mini-btn:hover {
      opacity: .92;
    }

    /* ‚úÖ Secciones plegables */
    .section {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .section-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      cursor: pointer;
      user-select: none;
    }

    .section-title {
      font-weight: bold;
      font-size: 15px;
    }

    .section-body {
      margin-top: 10px;
      display: none;
    }

    .section.open .section-body {
      display: block;
    }

    .btn-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 700px) {
      .btn-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .bigbtn {
      width: 100%;
      padding: 14px;
      font-weight: bold;
      cursor: pointer;
      border: 0;
      border-radius: 12px;
      background: #1976d2;
      color: #fff;
      font-size: 15px;
    }

    .bigbtn:hover {
      opacity: .92;
    }

    /* ‚úÖ Buscador r√°pido afuera */
    .buscador-wrap {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .chip {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(255, 255, 255, .08);
      border: 1px solid rgba(255, 255, 255, .12);
      cursor: pointer;
      user-select: none;
    }

    .chip input {
      width: auto;
      margin: 0;
      transform: scale(1.1);
    }

    #buscador-resultados .card {
      background: #fff;
      color: #000;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
    }

    /* ‚úÖ Ventanita abajo: bases guardadas (scroll) */
    .bases-window {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .bases-window-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      gap: 10px;
    }

    .bases-window-title {
      font-weight: bold;
      font-size: 15px;
    }

    .bases-window-body {
      margin-top: 10px;
      display: none;
    }

    .bases-window.open .bases-window-body {
      display: block;
    }

    /* ‚öôÔ∏è Esto es lo que pediste: 3 visibles aprox + scroll */
    #lista-bases-inline {
      max-height: 260px;          /* ~3 cards seg√∫n tama√±o */
      overflow-y: auto;           /* scroll lateral */
      padding-right: 6px;         /* deja lugar para ‚Äúcursor‚Äù */
    }

    #lista-bases-inline .card {
      background: #fff;
      color: #000;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
    }

    /* ‚ùå Nunca mostrar aviso de actualizaci√≥n */
    #update-bar { display: none !important; }
  </style>
</head>

<body>

  <!-- Logo para PDF -->
  <img id="logo-pdf" src="images/logo.jpg" alt="logo" />

  <!-- Logo visible -->
  <img src="images/logo_blanco.jpg" alt="Logo Se√±alco" class="logo-entrada">

  <h1>üìä Base de Datos - Se√±alco</h1>

  <!-- (Se mantiene por compatibilidad, pero est√° apagado por CSS) -->
  <div id="update-bar">
    <div class="msg">‚¨ÜÔ∏è Hay una actualizaci√≥n disponible</div>
    <div class="actions">
      <button class="mini-btn" id="btn-actualizar-app">Actualizar</button>
      <button class="mini-btn" id="btn-ignorar-update" style="background:#555;">M√°s tarde</button>
    </div>
  </div>

  <label>Entidad</label>
  <input type="text" id="entidad" list="lista-entidades" placeholder="Ej: Banco Galicia" />
  <datalist id="lista-entidades"></datalist>

  <label>Sucursal</label>
  <input type="text" id="sucursal" placeholder="Ej: 1234" />

  <label>Abonado</label>
  <input type="text" id="abonado" placeholder="Ej: 000123" />

  <label>Central</label>
  <input type="text" id="central" placeholder="Ej: Acicomp" />

  <label>Provincia</label>
  <input type="text" id="provincia" placeholder="Ej: Buenos Aires" />

  <table id="tabla-base">
    <thead>
      <tr>
        <th>Zona</th>
        <th>Evento</th>
        <th>√Årea</th>
        <th>Dispositivo</th>
        <th>Descripci√≥n</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- ‚úÖ SECCI√ìN 1: Importar (plegable / ocultable) -->
  <div class="section" id="sec-importar">
    <div class="section-head" onclick="toggleSection('sec-importar')">
      <div class="section-title">üì• Importar</div>
      <div style="opacity:.9;">‚¨áÔ∏è</div>
    </div>

    <div class="section-body">
      <div class="btn-grid">
        <button class="bigbtn" id="btn-subir-excel">üìÇ Importar Excel</button>
        <input id="input-excel-base" type="file"
          accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          style="position:absolute; left:-9999px; width:1px; height:1px;" />

        <button class="bigbtn" id="btn-importar-json-top">üì§ Importar JSON</button>
        <input id="input-json-base-top" type="file" accept="application/json,.json"
          style="position:absolute; left:-9999px; width:1px; height:1px;" />

        <button class="bigbtn" id="btn-importar-carpeta-top">üì¶ Importar carpeta (muchos JSON)</button>
        <input id="input-json-folder-top" type="file" accept=".json,application/json" multiple webkitdirectory directory
          style="position:absolute; left:-9999px; width:1px; height:1px;" />
      </div>
    </div>
  </div>

  <!-- ‚úÖ SECCI√ìN 2: Acciones (plegable / ocultable) -->
  <div class="section open" id="sec-acciones">
    <div class="section-head" onclick="toggleSection('sec-acciones')">
      <div class="section-title">‚öôÔ∏è Acciones</div>
      <div style="opacity:.9;">‚¨ÜÔ∏è</div>
    </div>

    <div class="section-body">
      <div class="btn-grid">
        <button class="bigbtn" id="btn-limpiar-base">üßπ Limpiar</button>

        <!-- ‚úÖ Guardar + backup ya descarga JSON => NO ponemos Descargar JSON aparte -->
        <button class="bigbtn" id="btn-guardar-rapido">üíæ Guardar en Mis Bases + Backup</button>

        <button class="bigbtn" id="btn-previsualizar">üëÅÔ∏è Previsualizar</button>

        <button class="bigbtn" id="btn-generar-pdf-base">üìÑ Generar PDF</button>

        <button class="bigbtn" id="btn-excel-base">üìä Exportar Excel</button>

        <button class="bigbtn" id="btn-editar-zonas123">üîì Editar Zonas 1-3</button>
        <button class="bigbtn" id="btn-bloquear-zonas123" style="display:none;">üîí Bloquear Zonas 1-3</button>

        <button class="bigbtn" onclick="cerrarSesion()">üîí Cerrar sesi√≥n</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ BUSCADOR R√ÅPIDO -->
  <div class="buscador-wrap">
    <h3 style="margin:0 0 8px;">üîé Buscador r√°pido de Bases</h3>

    <input id="buscar-rapido" placeholder="Escrib√≠ 3 letras (ej: gal) y filtra al toque..." />

    <div style="opacity:.9; font-size:13px; margin-top:6px;">
      ‚úÖ Eleg√≠ en qu√© campos buscar (tild√°s casillas):
    </div>

    <div class="chips" id="filtros-wrap">
      <label class="chip"><input type="checkbox" class="filtro-check" value="entidad" checked>Entidad</label>
      <label class="chip"><input type="checkbox" class="filtro-check" value="sucursal" checked>Sucursal</label>
      <label class="chip"><input type="checkbox" class="filtro-check" value="abonado" checked>Abonado</label>
      <label class="chip"><input type="checkbox" class="filtro-check" value="central" checked>Central</label>
      <label class="chip"><input type="checkbox" class="filtro-check" value="provincia" checked>Provincia</label>
      <label class="chip"><input type="checkbox" class="filtro-check" value="nombre" checked>Nombre</label>
    </div>

    <div id="buscador-resultados" style="margin-top:12px;"></div>

    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="mini-btn" id="btn-limpiar-buscador" style="background:#555;">Limpiar b√∫squeda</button>
    </div>
  </div>

  <!-- ‚úÖ Ventanita abajo (sin ‚ÄúMis Bases‚Äù como opci√≥n) -->
  <div class="bases-window open" id="bases-window">
    <div class="bases-window-head" onclick="toggleBasesWindow()">
      <div class="bases-window-title">üìÅ Bases guardadas (lista)</div>
      <div id="bases-window-arrow" style="opacity:.9;">‚¨ÜÔ∏è</div>
    </div>

    <div class="bases-window-body">
      <!-- Ac√° renderiza la lista (m√°ximo ~3 visibles + scroll) -->
      <div id="lista-bases-inline"></div>
    </div>
  </div>

  <!-- ‚úÖ Modal Previsualizar (lo mantiene el JS) -->
  <div id="modal-prev" class="modal">
    <div class="box">
      <div class="row">
        <h2 style="margin:0;">Previsualizaci√≥n de Base</h2>
        <button class="mini-btn" id="btn-cerrar-prev">Cerrar ‚úñ</button>
      </div>
      <div id="prev-body" style="margin-top:12px;"></div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="mini-btn" id="btn-descargar-pdf-prev">‚úÖ Descargar PDF</button>
      </div>
    </div>
  </div>

  <script>
    function cerrarSesion() {
      localStorage.removeItem("logueado");
      localStorage.removeItem("perfil");
      window.location.href = "login.html";
    }

    function toggleSection(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.toggle("open");
      const arrow = el.querySelector(".section-head div:last-child");
      if (arrow) arrow.textContent = el.classList.contains("open") ? "‚¨ÜÔ∏è" : "‚¨áÔ∏è";
    }

    function toggleBasesWindow() {
      const el = document.getElementById("bases-window");
      const arrow = document.getElementById("bases-window-arrow");
      if (!el) return;
      el.classList.toggle("open");
      if (arrow) arrow.textContent = el.classList.contains("open") ? "‚¨ÜÔ∏è" : "‚¨áÔ∏è";
    }
  </script>

  <!-- ‚úÖ IMPORTANTE: orden correcto -->
  <script src="idb-base.js"></script>
  <script src="java-base.js"></script>

</body>

</html>