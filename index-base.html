<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Base de Datos - SeÃ±alco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="estilo.css" />

  <!-- PDF (salida) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>

  <!-- Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

  <script defer src="java-base.js"></script>

  <script>
    if (localStorage.getItem("logueado") !== "true") {
      window.location.href = "login.html";
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 1000px;
      margin: auto;
      background: #0b0b20;
      color: #fff;
    }

    h1 {
      text-align: center;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #333;
      background: #121235;
      color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #0d0d2a;
    }

    table,
    th,
    td {
      border: 1px solid #0a0a0a;
    }

    th,
    td {
      padding: 6px;
      text-align: center;
    }

    .botones {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    .botones button {
      flex: 1 1 220px;
      padding: 12px;
      font-weight: bold;
      cursor: pointer;
      border: 0;
      border-radius: 10px;
      background: #1976d2;
      color: #fff;
    }

    .botones button:hover {
      opacity: .92;
    }

    .zonaInput {
      width: 100%;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #333;
      background: #14143a;
      color: #fff;
    }

    .mini-btn {
      padding: 10px 14px;
      border-radius: 10px;
      background: #444;
      color: #fff;
      border: 0;
      cursor: pointer;
      font-weight: bold;
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .65);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .modal .box {
      background: #fff;
      color: #000;
      width: min(95vw, 900px);
      border-radius: 14px;
      padding: 16px;
      max-height: 85vh;
      overflow: auto;
    }

    .modal .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      background: #fafafa;
    }

    #logo-pdf {
      display: none;
    }

    .logo-entrada {
      width: 140px;
      display: block;
      margin: 10px auto 0;
    }
  </style>
</head>

<body onload="asignarEventosBase(); precargarZonas(); obtenerBasesGuardadas();">
  <img id="logo-pdf" src="images/logo.jpg" alt="logo" />
  <img src="images/logo_blanco.jpg" alt="Logo SeÃ±alco" class="logo-entrada">

  <h1>ğŸ“Š Base de Datos - SeÃ±alco</h1>

  <label>Entidad</label>
  <input type="text" id="entidad" placeholder="Ej: Galicia" />

  <label>Sucursal</label>
  <input type="text" id="sucursal" placeholder="Ej: 1234" />

  <label>Abonado</label>
  <input type="text" id="abonado" placeholder="Ej: 000123" />

  <label>Central</label>
  <input type="text" id="central" placeholder="Ej: Acicomp" />

  <label>Provincia</label>
  <input type="text" id="provincia" placeholder="Ej: Buenos Aires" />

  <table id="tabla-base">
    <thead>
      <tr>
        <th>Zona</th>
        <th>Evento</th>
        <th>Ãrea</th>
        <th>Dispositivo</th>
        <th>DescripciÃ³n</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="botones">
    <button id="btn-limpiar-base">ğŸ§¹ Limpiar</button>

    <button id="btn-subir-excel">ğŸ“‚ Subir Excel a modificar</button>
    <input id="input-excel-base" type="file"
      accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      style="position:absolute; left:-9999px; width:1px; height:1px;" />

    <button id="btn-previsualizar">ğŸ‘ï¸ Previsualizar</button>

    <button id="btn-generar-pdf-base">ğŸ“„ Generar PDF (opcional)</button>
    <button id="btn-excel-base">ğŸ“Š Exportar Excel</button>

    <button id="btn-guardar-local">ğŸ’¾ Guardar Base (Local)</button>
    <button id="btn-mis-bases">ğŸ“ Mis Bases</button>

    <button onclick="cerrarSesion()">ğŸ”’ Cerrar sesiÃ³n</button>
  </div>

  <div style="margin-top: 26px;">
    <h3>ğŸ“ Borradores disponibles (clÃ¡sico)</h3>
    <ul id="lista-bases"></ul>
    <button class="mini-btn" onclick="guardarBorradorBase('borrador1')">ğŸ’¾ Guardar como Borrador 1</button>
    <button class="mini-btn" onclick="guardarBorradorBase('borrador2')">ğŸ’¾ Guardar como Borrador 2</button>
  </div>

  <!-- MODAL: PREVISUALIZAR -->
  <div id="modal-prev" class="modal">
    <div class="box">
      <div class="row">
        <h2 style="margin:0;">PrevisualizaciÃ³n de Base</h2>
        <button class="mini-btn" id="btn-cerrar-prev">Cerrar âœ–</button>
      </div>
      <div id="prev-body" style="margin-top:12px;"></div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="mini-btn" id="btn-descargar-pdf-prev">âœ… Descargar PDF</button>
      </div>
    </div>
  </div>

  <!-- MODAL: MIS BASES -->
  <div id="modal-bases" class="modal">
    <div class="box">
      <div class="row">
        <h2 style="margin:0;">ğŸ“ Mis Bases (guardadas en el telÃ©fono)</h2>
        <button class="mini-btn" id="btn-cerrar-bases">Cerrar âœ–</button>
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <input id="nombre-base" placeholder="Nombre (ej: Galicia_Suc123)"
          style="flex:1; min-width:220px; padding:10px;">
        <button class="mini-btn" id="btn-guardar-como">Guardar como</button>

        <button class="mini-btn" id="btn-descargar-json">Descargar JSON</button>
        <button class="mini-btn" id="btn-importar-json">Importar JSON</button>
        <input id="input-json-base" type="file" accept="application/json,.json"
          style="position:absolute; left:-9999px; width:1px; height:1px;" />

        <button class="mini-btn" id="btn-compartir-json">Compartir JSON</button>
        <button class="mini-btn" id="btn-compartir-excel">Compartir Excel</button>
      </div>

      <hr style="margin:14px 0;">
      <div id="lista-bases-json"></div>
    </div>
  </div>

  <script>
    function cerrarSesion() {
      localStorage.removeItem("logueado");
      localStorage.removeItem("perfil");
      window.location.href = "login.html";
    }
  </script>
</body>

</html>