<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relevamiento de Alarmas</title>
    <link rel="stylesheet" href="estilo.css" />

    <script>
        if (localStorage.getItem("logueado") !== "true") {
            window.location.href = "index.html";
        }
    </script>
    <script src="auth-guard.js"></script>
    <!-- ‚úÖ Estilos m√≠nimos para el panel de vista previa (no pisa tu CSS) -->
    <style>
        .preview-box {
            margin-top: 14px;
            background: #fff;
            color: #000;
            border-radius: 14px;
            padding: 14px;
            box-shadow: 0 0 18px rgba(0, 0, 0, .15);
            display: none;
        }

        .preview-box.active {
            display: block;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        @media (max-width:600px) {
            .preview-grid {
                grid-template-columns: 1fr;
            }
        }

        .preview-kpi {
            background: #f6f6f6;
            border: 1px solid #e4e4e4;
            border-radius: 12px;
            padding: 10px;
            font-size: 14px;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }

        .preview-table th,
        .preview-table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
            vertical-align: top;
        }

        .preview-table th {
            background: #c10202;
            color: #fff;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <img id="logo" src="images/logo.jpg" style="display:none;" />

    <div style="text-align:center; margin-bottom:10px;">
        <img src="images/logo_blanco.jpg" alt="Logo Se√±alco" class="logo-entrada">
    </div>

    <form>
        <h1>Relevamiento</h1>

        <!-- PASO 1 -->
        <div class="seccion">
            <label for="entidad">Entidad</label>
            <input type="text" id="entidad" required />

            <label for="sucursal">Sucursal</label>
            <input type="text" id="sucursal" required />

            <label for="direccion">Direcci√≥n</label>
            <input type="text" id="direccion" required />

            <label for="fecha">Fecha</label>
            <input type="date" id="fecha" required />

            <label for="remito">Remito</label>
            <input type="text" id="remito" />

            <label for="relevado">Relevado por el t√©cnico</label>
            <input type="text" id="relevado" />
        </div>

        <!-- PASO 2 -->
        <div class="seccion">
            <div id="contenedor-sectores"></div>
            <button type="button" id="btn-agregar-sector">Agregar Sector</button>
        </div>

        <!-- NAVEGACI√ìN -->
        <div class="navegacion">
            <button type="button" id="atras">Atr√°s</button>
            <button type="button" id="siguiente">Siguiente</button>

            <button type="button" id="btn-generar-pdf">Generar PDF</button>
            <button type="button" id="btn-borrar-form">Borrar formulario guardado</button>
        </div>

        <!-- ‚úÖ BLOQUE JSON + VISTA PREVIA -->
        <div style="margin-top:20px;">
            <h3>üì¶ Gesti√≥n (JSON / Tel√©fono)</h3>

            <div class="navegacion">
                <button type="button" id="btn-vista-previa">üëÅÔ∏è Vista previa</button>

                <button type="button" id="btn-guardar-json">üíæ Guardar JSON</button>
                <button type="button" id="btn-descargar-json">‚¨áÔ∏è Descargar JSON</button>

                <button type="button" id="btn-importar-json">üì§ Importar JSON</button>
                <input type="file" id="file-json" accept="application/json" style="display:none;" />
            </div>

            <!-- ‚úÖ Panel de Vista Previa -->
            <div id="preview-box" class="preview-box">
                <h3 style="margin:0;">üëÅÔ∏è Vista previa del relevamiento</h3>
                <div id="preview-head" class="preview-grid"></div>
                <div id="preview-kpis" class="preview-grid"></div>

                <div class="preview-actions">
                    <button type="button" id="btn-preview-cerrar">Cerrar vista</button>
                    <button type="button" id="btn-preview-descargar">‚¨áÔ∏è Descargar JSON</button>
                </div>

                <div style="margin-top:10px;">
                    <h4 style="margin:10px 0;">Detalle (tabla)</h4>
                    <div style="overflow:auto;">
                        <table class="preview-table" id="preview-table">
                            <thead>
                                <tr>
                                    <th>Sector</th>
                                    <th>Dispositivo</th>
                                    <th>Cant.</th>
                                    <th>Modelo</th>
                                    <th>Zona</th>
                                    <th>Obs</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <p style="color:#fff; opacity:.85; margin-top:10px;">
                Tip: Descarg√°s el JSON y lo compart√≠s desde ‚ÄúDescargas‚Äù por WhatsApp/Mail.
            </p>

            <h3 style="margin-top:18px;">üìÅ Relevamientos guardados</h3>
            <ul id="lista-relevamientos"></ul>

            <div class="navegacion">
                <button type="button" id="btn-borrador-1">üíæ Guardar como Borrador 1</button>
                <button type="button" id="btn-borrador-2">üíæ Guardar como Borrador 2</button>
            </div>
        </div>

        <!-- DRIVE -->
        <div style="margin-top: 20px;">
            <label>üì∏ Sub√≠ tus fotos</label><br>
            <a href="https://drive.google.com/drive/folders/1NXZR2d9FAMhaSio-xZ4JsF-HUEnsrbOR?usp=sharing"
                target="_blank" class="drive-link">
                ‚ûï Subir archivos INSTALACIONES/OBRAS
            </a>
            <br>
            <a href="https://drive.google.com/drive/folders/1gnHhmociP3fHu_ecxoa6A7D9ZbnNRnlf?usp=sharing"
                target="_blank" class="drive-link">
                ‚ûï Subir archivos SERVICE
            </a>
            <p class="drive-note">(Abrir√° Drive; cre√° tu carpeta de t√©cnico y sub√≠ ah√≠)</p>
        </div>
    </form>

    <!-- Librer√≠as PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>

    <script src="javas.js"></script>

    <div style="text-align:center; margin-top:30px;">
        <button type="button" onclick="cerrarSesion()" style="padding:10px 20px; font-size:16px;">
            üîí Cerrar sesi√≥n
        </button>
    </div>

    <script>
        function cerrarSesion() {
            localStorage.removeItem("logueado");
            window.location.href = "login.html";
        }
    </script>
</body>

</html>